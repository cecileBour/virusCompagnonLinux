# virusCompagnonLinux
Ceci est un exemple de virus par accompagnement exploitant la hiérarchisation des chemins de recherche d'exécutables : variable PATH sur les systèmes GNU/Linux

## Pourquoi ?
On entend trop souvent à tord le mot de virus pour désigner l'ensemble des programmes malveillants, pourtant il faut bien comprendre qu’il existe deux types d’infections informatiques, à savoir les infections simples (c’est le cas par exemple des bombes logiques, des chevaux de Troie, des leurres, des keyloggers, des RATs, etc) et les infections de code autoreproducteur (c’est le cas des virus et des vers)

## Rappel sur l'infection par accompagnement de code
Je vais vous présenter un virus qui utilise un des nombreux mode d'infection virale, à savoir l'infection par accompagnement de code.

L’infection par accompagnement de code est une méthode peu connue mais redoutable qui consiste à "accompagner le code" : on ne modifie pas le fichier mais son environnement. Le code est dupliqué mais n’est pas inséré dans la cible, on crée un fichier qui "accompagne" la cible. De cette manière, lorsque l’utilisateur exécute le fichier infecté ou le "dropper", c’est d’abord le code viral accompagnant qui est exécuté, puis il donne la main au fichier légitime afin d’assurer la furtivité. Il y a trois grands types de mécanismes qui sont utilisés pour réaliser ce genre d’accompagnement :
- la hiérarchisation des exécutions : c’est l’exemple des systèmes DOS qui exécutent des fichiers selon la hiérarchie suivante : dans un dossier contenant un programme nommé "jeu", le premier exécuté sera jeu.com puis jeu.exe puis jeu.bat. Ainsi, si la cible est un fichier .exe, il suffit de créer une copie du virus avec le même nom mais qui porte l’extension .com (remarque : dans ce cas le fichier ne doit pas dépasser les 64Ko, ce qui peut fortement limiter l’action, à moins que l’on utilise encore d’autres moyens). Sur Windows on peut utiliser des icônes transparentes, des fichiers cachés, des chaines d’extensions de type exécutable qui sont naturellement invisibles ;
- l’utilisation de la hiérarchie des chemins de recherche d’exécutables : c’est le cas de la variable PATH. Afin d'expliquer brièvement le fonctionnement, la variable PATH est contenue dans le fichier .bash_profile, elle contient une liste de dossiers dans lesquelles se trouvent des programmes/commandes. Ainsi lorsque l’on execute un programme ou une commande dans un terminal par exemple, la commande sera recherchée dans le premier dossier, si elle est trouvée elle est lancée, sinon elle est recherchée dans le deuxième dossier et ainsi de suite. Prenons un exemple, si l’on souhaite infecter la commande sudo sur un système linux (qui est la commande la plus importante puisqu’elle nous permet d’obtenir tous les privilèges sur le système), on peut intégrer notre code viral dans un dropper, qui une fois lancé par la victime, créera un dossier caché dans le dossier /tmp par exemple qui est accessible en lecture et en écriture, dossier dans lequel est copié notre fichier qui va accompagner la commande sudo et qui contient le code viral. Ce dossier est ajouté en première position dans la variable PATH. Ainsi lorsque la victime voudra devenir root et donc avoir tous les privilèges, ce sera notre virus qui sera appelé et comme d’habitude la victime sera invité à entrer son mot de passe, mot de passe que l'on récupèrera et qui nous sera transmis à l’aide de techniques de vers utilisant par exemple les réseaux ou plus simplement des adresses mails. Ensuite on déclenche une erreur qui signale à la victime que le mot de passe entré n’est pas valide puis on redonne la main à la vraie commande sudo. De cette manière l’utilisateur ne constate pas la présence d’un code viral, pendant que nous obtenons tous les accès à sa machine ;
- enfin la dernière technique, qui est la plus simple et la plus indépendante de l’OS, consiste à renommer la cible, et prendre sa place. Le virus sera donc exécuté en premier, il suffit de gérer l’exécution du fichier original.

## Explications de mon code : 
Dans mon code nous exploitons la hiérarchisation des chemins de recherche d'exécutables pour les systèmes Linux, en exploitant la variable PATH, le dropper est une simple visionneuse d'image qui une fois exécutée modifiera l'environnement (variable PATH) sans modifier les cibles qui sont les commandes rpm et sudo.
Mon code est très bien commenté afin que vous puissiez le comprendre le mieux possible.

## Compilation :
gcc viru2mdp.c -o imageview
